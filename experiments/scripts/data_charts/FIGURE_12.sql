-- #### FIGURE 12. CORRELATION MATRIX OF KEY FEATURES ####
--MATMUL
SELECT
ZZZ.VL_EXECUTION_TIME AS "Parallel task exec. time",
ZZZ.VL_BLOCK_MEMORY_SIZE as "Block size",
ZZZ.VL_GRID_DIMENSION_SIZE as "Grid dimension",
ZZZ.P_FRACTION as "Parallel fraction",
ZZZ.PARAMETER_X as "Algorithm-specific param.",
ZZZ.TASK_COMPUTATIONAL_COMPLEXITY as "Computational complexity",
ZZZ.DAG_MAX_WIDTH as "DAG maximum width",
ZZZ.DAG_MAX_HEIGHT as "DAG maximum height",
ZZZ.VL_DATASET_MEMORY_SIZE as "Dataset size",
ZZZ.CPU as "CPU",
ZZZ.GPU as "GPU",
ZZZ.SHARED_DISK as "Shared disk storage",
ZZZ.LOCAL_DISK as "Local disk storage",
ZZZ.ORDER_STRICT_SCHEDULER as "Task gen. order scheduling",
ZZZ.DATA_LOCAL_SCHEDULER as "Data locality scheduling"
FROM
(
SELECT
ROUND(CAST(ZZ.VL_TOTAL_EXECUTION_TIME AS NUMERIC),2) AS VL_EXECUTION_TIME,
ZZ.VL_BLOCK_MEMORY_SIZE,
ZZ.VL_GRID_ROW_DIMENSION*ZZ.VL_GRID_COLUMN_DIMENSION AS VL_GRID_DIMENSION_SIZE,
ZZ.P_FRACTION,
ZZ.PARAMETER_X,
ROUND(CAST((ZZ.VL_BLOCK_ROW_DIMENSION*ZZ.VL_BLOCK_ROW_DIMENSION*ZZ.VL_BLOCK_ROW_DIMENSION + ZZ.VL_BLOCK_ROW_DIMENSION)*1E-9 AS NUMERIC),2) TASK_COMPUTATIONAL_COMPLEXITY,
ZZ.VL_GRID_ROW_DIMENSION*ZZ.VL_GRID_ROW_DIMENSION*ZZ.VL_GRID_ROW_DIMENSION AS DAG_MAX_WIDTH,
ROUND(CAST((1+log(2,ZZ.VL_GRID_ROW_DIMENSION)) AS NUMERIC),0) AS DAG_MAX_HEIGHT,
ZZ.VL_DATASET_MEMORY_SIZE,
CASE
	WHEN ZZ.DS_DEVICE = 'CPU' THEN 1
	ELSE 0
END AS CPU,
CASE
	WHEN ZZ.DS_DEVICE = 'GPU' THEN 1
	ELSE 0
END AS GPU,
CASE
	WHEN ZZ.DS_STORAGE = 'GPFS' THEN 1
	ELSE 0
END AS SHARED_DISK,
CASE
	WHEN ZZ.DS_STORAGE = 'LOCAL_DISK' THEN 1
	ELSE 0
END AS LOCAL_DISK,
CASE
	WHEN ZZ.DS_SCHEDULER = 'es.bsc.compss.scheduler.orderstrict.fifo.FifoTS' THEN 1
	ELSE 0
END AS ORDER_STRICT_SCHEDULER,
CASE
	WHEN ZZ.DS_SCHEDULER = 'es.bsc.compss.scheduler.lookahead.successors.fifolocality.FifoLocalityTS' THEN 1
	ELSE 0
END AS DATA_LOCAL_SCHEDULER
FROM
(
	SELECT
	Y.VL_TOTAL_EXECUTION_TIME,
	Y.VL_INTER_TASK_EXECUTION_TIME,
	(Y.VL_INTER_TASK_EXECUTION_TIME - Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTER_TASK_OVERHEAD_TIME,
	Y.VL_INTER_TASK_EXECUTION_TIME - (Y.VL_INTER_TASK_EXECUTION_TIME - Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTER_TASK_EXECUTION_TIME_FREE_OVERHEAD,
	Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
	Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
	Y.VL_COMMUNICATION_TIME,
	Y.VL_ADDITIONAL_TIME,
	(Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC + Y.VL_COMMUNICATION_TIME) AS VL_INTRA_TASK_EXECUTION_TIME_FREE_ADDITIONAL,
	COALESCE(ROUND(((Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC)/(Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC-Y.VL_COMMUNICATION_TIME))::numeric,2),1.00) AS P_FRACTION,
	Y.ID_PARAMETER,
	Y.CD_PARAMETER,
	Y.CD_CONFIGURATION,
	Y.ID_ALGORITHM,
	Y.DS_ALGORITHM,
	Y.ID_FUNCTION,
	Y.DS_FUNCTION,
	Y.ID_DEVICE,
	Y.DS_DEVICE,
	Y.ID_DATASET,
	Y.ID_RESOURCE,
	Y.ID_PARAMETER_TYPE,
	Y.DS_PARAMETER_TYPE,
	Y.DS_PARAMETER_ATTRIBUTE,
	Y.PARAMETER_X,
	Y.DS_STORAGE,
	Y.DS_SCHEDULER,
	Y.NR_ITERATIONS,
	Y.VL_GRID_ROW_DIMENSION,
	Y.VL_GRID_COLUMN_DIMENSION,
	Y.VL_GRID_ROW_X_COLUMN_DIMENSION,
	Y.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
	Y.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
	Y.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
	Y.VL_BLOCK_ROW_DIMENSION,
	Y.VL_BLOCK_COLUMN_DIMENSION,
	Y.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
	Y.VL_BLOCK_MEMORY_SIZE,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
	Y.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
	Y.DS_RESOURCE,
	Y.NR_NODES,
	Y.NR_COMPUTING_UNITS_CPU,
	(Y.NR_NODES-1)*Y.NR_COMPUTING_UNITS_CPU AS NR_TOTAL_COMPUTING_UNITS_CPU,
	(Y.NR_NODES-1) || ' (' || (Y.NR_NODES-1)*Y.NR_COMPUTING_UNITS_CPU || ')' AS NR_CONCAT_NODES_TOTAL_COMPUTING_UNITS_CPU,
	Y.NR_COMPUTING_UNITS_GPU,
	Y.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
	Y.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
	Y.DS_DATASET,
	Y.VL_DATASET_MEMORY_SIZE,
	Y.DS_DATA_TYPE,
	Y.VL_DATA_TYPE_MEMORY_SIZE,
	Y.VL_DATASET_DIMENSION,
	Y.VL_DATASET_ROW_DIMENSION,
	Y.VL_DATASET_COLUMN_DIMENSION,
	Y.VL_DATASET_ROW_X_COLUMN_DIMENSION,
	Y.NR_RANDOM_STATE
	FROM
	(
		SELECT
		AVG(X.VL_TOTAL_EXECUTION_TIME) AS VL_TOTAL_EXECUTION_TIME,
		AVG(X.VL_INTER_TASK_EXECUTION_TIME) AS VL_INTER_TASK_EXECUTION_TIME,
		AVG(X.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
		AVG(X.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC) AS VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
		AVG(X.VL_COMMUNICATION_TIME_1) AS VL_COMMUNICATION_TIME_1,
		AVG(X.VL_COMMUNICATION_TIME_2) AS VL_COMMUNICATION_TIME_2,
		AVG(X.VL_COMMUNICATION_TIME) AS VL_COMMUNICATION_TIME,
		AVG(X.VL_ADDITIONAL_TIME_1) AS VL_ADDITIONAL_TIME_1,
		AVG(X.VL_ADDITIONAL_TIME_2) AS VL_ADDITIONAL_TIME_2,
		AVG(X.VL_ADDITIONAL_TIME) AS VL_ADDITIONAL_TIME,
		X.ID_PARAMETER,
		X.CD_PARAMETER,
		X.CD_CONFIGURATION,
		X.ID_ALGORITHM,
		X.DS_ALGORITHM,
		X.ID_FUNCTION,
		X.DS_FUNCTION,
		X.ID_DEVICE,
		X.DS_DEVICE,
		X.ID_DATASET,
		X.ID_RESOURCE,
		X.ID_PARAMETER_TYPE,
		X.DS_PARAMETER_TYPE,
		X.DS_PARAMETER_ATTRIBUTE,
		X.PARAMETER_X,
		X.DS_STORAGE,
		X.DS_SCHEDULER,
		X.NR_ITERATIONS,
		X.VL_GRID_ROW_DIMENSION,
		X.VL_GRID_COLUMN_DIMENSION,
		X.VL_GRID_ROW_X_COLUMN_DIMENSION,
		X.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
		X.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_BLOCK_ROW_DIMENSION,
		X.VL_BLOCK_COLUMN_DIMENSION,
		X.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
		X.VL_BLOCK_MEMORY_SIZE,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.DS_RESOURCE,
		X.NR_NODES,
		X.NR_COMPUTING_UNITS_CPU,
		X.NR_COMPUTING_UNITS_GPU,
		X.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
		X.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
		X.DS_DATASET,
		X.VL_DATASET_MEMORY_SIZE,
		X.DS_DATA_TYPE,
		X.VL_DATA_TYPE_MEMORY_SIZE,
		X.VL_DATASET_DIMENSION,
		X.VL_DATASET_ROW_DIMENSION,
		X.VL_DATASET_COLUMN_DIMENSION,
		X.VL_DATASET_ROW_X_COLUMN_DIMENSION,
		X.NR_RANDOM_STATE
		FROM
		(
			SELECT
				A.ID_EXPERIMENT,
				A.VL_TOTAL_EXECUTION_TIME,
				A.VL_INTER_TASK_EXECUTION_TIME,
				A.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
				A.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
				A.VL_COMMUNICATION_TIME_1,
				A.VL_COMMUNICATION_TIME_2,
				A.VL_COMMUNICATION_TIME_1 + A.VL_COMMUNICATION_TIME_2 AS VL_COMMUNICATION_TIME,
				A.VL_ADDITIONAL_TIME_1,
				A.VL_ADDITIONAL_TIME_2,
				A.VL_ADDITIONAL_TIME_1 + A.VL_ADDITIONAL_TIME_2 AS VL_ADDITIONAL_TIME,
				(A.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC + A.VL_ADDITIONAL_TIME_1 + A.VL_ADDITIONAL_TIME_2) AS VL_INTRA_TASK_EXECUTION_TIME_FREE_ADDITIONAL,
				A.DT_PROCESSING,
				B.ID_PARAMETER,
				B.CD_PARAMETER,
				B.CD_CONFIGURATION,
				B.ID_ALGORITHM,
				(SELECT DISTINCT X.DS_ALGORITHM FROM ALGORITHM X WHERE X.ID_ALGORITHM = B.ID_ALGORITHM) AS DS_ALGORITHM,
				B.ID_FUNCTION,
				(SELECT DISTINCT X.DS_FUNCTION FROM FUNCTION X WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS DS_FUNCTION,
				(SELECT DISTINCT Y.ID_DEVICE FROM FUNCTION X INNER JOIN DEVICE Y ON (X.ID_DEVICE = Y.ID_DEVICE) WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS ID_DEVICE,
				(SELECT DISTINCT Y.DS_DEVICE FROM FUNCTION X INNER JOIN DEVICE Y ON (X.ID_DEVICE = Y.ID_DEVICE) WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS DS_DEVICE,
				B.ID_DATASET,
				B.ID_RESOURCE,
				B.ID_PARAMETER_TYPE,
				(SELECT X.DS_PARAMETER_TYPE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_PARAMETER_TYPE,
				(SELECT X.DS_PARAMETER_ATTRIBUTE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_PARAMETER_ATTRIBUTE,
				(SELECT X.NR_CLUSTER FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS PARAMETER_X,
				(SELECT X.DS_STORAGE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_STORAGE,
				(SELECT X.DS_SCHDEULER FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_SCHEDULER,
				B.NR_ITERATIONS,
				B.VL_GRID_ROW_DIMENSION,
				B.VL_GRID_COLUMN_DIMENSION,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION AS VL_GRID_ROW_X_COLUMN_DIMENSION,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION || '(' || ROUND(B.VL_BLOCK_MEMORY_SIZE*1e-6,2) || ')' AS VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
				ROUND((CAST(B.VL_GRID_COLUMN_DIMENSION AS NUMERIC)/CAST(D.VL_DATASET_COLUMN_DIMENSION AS NUMERIC))*100,2) AS VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION || ' (' || ROUND((CAST(B.VL_GRID_COLUMN_DIMENSION AS NUMERIC)/CAST(D.VL_DATASET_COLUMN_DIMENSION AS NUMERIC))*100,2) || '%)' AS VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
				B.VL_BLOCK_ROW_DIMENSION,
				B.VL_BLOCK_COLUMN_DIMENSION,
				B.VL_BLOCK_ROW_DIMENSION || ' x ' || B.VL_BLOCK_COLUMN_DIMENSION AS VL_BLOCK_ROW_X_COLUMN_DIMENSION,
				B.VL_BLOCK_MEMORY_SIZE,
				B.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
				B.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
				ROUND((CAST(B.VL_BLOCK_MEMORY_SIZE AS NUMERIC)/CAST(D.VL_DATASET_MEMORY_SIZE AS NUMERIC))*100,2) AS VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
				ROUND(B.VL_BLOCK_MEMORY_SIZE*1e-6,2) || ' (' || ROUND((CAST(B.VL_BLOCK_MEMORY_SIZE AS NUMERIC)/CAST(D.VL_DATASET_MEMORY_SIZE AS NUMERIC))*100,2) || '%)' AS VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
				C.DS_RESOURCE,
				C.NR_NODES,
				C.NR_COMPUTING_UNITS_CPU,
				C.NR_COMPUTING_UNITS_GPU,
				C.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
				C.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
				D.DS_DATASET,
				D.VL_DATASET_MEMORY_SIZE,
				D.DS_DATA_TYPE,
				D.VL_DATA_TYPE_MEMORY_SIZE,
				D.VL_DATASET_DIMENSION,
				D.VL_DATASET_ROW_DIMENSION,
				D.VL_DATASET_COLUMN_DIMENSION,
				D.VL_DATASET_ROW_DIMENSION || ' x ' || D.VL_DATASET_COLUMN_DIMENSION AS VL_DATASET_ROW_X_COLUMN_DIMENSION,
				D.NR_RANDOM_STATE
			FROM EXPERIMENT_RAW A
			INNER JOIN PARAMETER B ON (A.ID_PARAMETER = B.ID_PARAMETER)
			INNER JOIN RESOURCE C ON (B.ID_RESOURCE = C.ID_RESOURCE)
			INNER JOIN DATASET D ON (B.ID_DATASET = D.ID_DATASET)
			WHERE
			A.NR_ALGORITHM_ITERATION <> 0
		) X
		GROUP BY
		X.ID_PARAMETER,
		X.CD_PARAMETER,
		X.CD_CONFIGURATION,
		X.ID_ALGORITHM,
		X.DS_ALGORITHM,
		X.ID_FUNCTION,
		X.DS_FUNCTION,
		X.ID_DEVICE,
		X.DS_DEVICE,
		X.ID_DATASET,
		X.ID_RESOURCE,
		X.ID_PARAMETER_TYPE,
		X.DS_PARAMETER_TYPE,
		X.DS_PARAMETER_ATTRIBUTE,
		X.PARAMETER_X,
		X.DS_STORAGE,
		X.DS_SCHEDULER,
		X.NR_ITERATIONS,
		X.VL_GRID_ROW_DIMENSION,
		X.VL_GRID_COLUMN_DIMENSION,
		X.VL_GRID_ROW_X_COLUMN_DIMENSION,
		X.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
		X.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_BLOCK_ROW_DIMENSION,
		X.VL_BLOCK_COLUMN_DIMENSION,
		X.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
		X.VL_BLOCK_MEMORY_SIZE,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.DS_RESOURCE,
		X.NR_NODES,
		X.NR_COMPUTING_UNITS_CPU,
		X.NR_COMPUTING_UNITS_GPU,
		X.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
		X.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
		X.DS_DATASET,
		X.VL_DATASET_MEMORY_SIZE,
		X.DS_DATA_TYPE,
		X.VL_DATA_TYPE_MEMORY_SIZE,
		X.VL_DATASET_DIMENSION,
		X.VL_DATASET_ROW_DIMENSION,
		X.VL_DATASET_COLUMN_DIMENSION,
		X.VL_DATASET_ROW_X_COLUMN_DIMENSION,
		X.NR_RANDOM_STATE
	) Y
) ZZ
WHERE ZZ.ds_algorithm='MATMUL_DISLIB'
AND ZZ.nr_iterations = 5
AND ZZ.ds_dataset = 'S_8GB_1'
AND ZZ.id_resource = 1
AND ZZ.ID_PARAMETER_TYPE IN (1,2,5,6)
AND ZZ.VL_TOTAL_EXECUTION_TIME IS NOT NULL
) AS ZZZ


--KMEANS
SELECT
ZZZ.VL_EXECUTION_TIME AS "Parallel task exec. time",
ZZZ.VL_BLOCK_MEMORY_SIZE as "Block size",
ZZZ.VL_GRID_DIMENSION_SIZE as "Grid dimension",
ZZZ.P_FRACTION as "Parallel fraction",
ZZZ.PARAMETER_X as "Algorithm-specific param.",
ZZZ.TASK_COMPUTATIONAL_COMPLEXITY as "Computational complexity",
ZZZ.DAG_MAX_WIDTH as "DAG maximum width",
ZZZ.DAG_MAX_HEIGHT as "DAG maximum height",
ZZZ.VL_DATASET_MEMORY_SIZE as "Dataset size",
ZZZ.CPU as "CPU",
ZZZ.GPU as "GPU",
ZZZ.SHARED_DISK as "Shared disk storage",
ZZZ.LOCAL_DISK as "Local disk storage",
ZZZ.ORDER_STRICT_SCHEDULER as "Task gen order scheduling",
ZZZ.DATA_LOCAL_SCHEDULER as "Data locality scheduling"
FROM
(
SELECT
ROUND(CAST(ZZ.VL_INTER_TASK_EXECUTION_TIME AS NUMERIC),2) AS VL_EXECUTION_TIME,
ZZ.VL_BLOCK_MEMORY_SIZE,
ZZ.VL_GRID_ROW_DIMENSION*ZZ.VL_GRID_COLUMN_DIMENSION AS VL_GRID_DIMENSION_SIZE,
ZZ.P_FRACTION,
ZZ.PARAMETER_X,
ROUND(CAST(ZZ.VL_BLOCK_ROW_DIMENSION*ZZ.VL_BLOCK_COLUMN_DIMENSION*(ZZ.PARAMETER_X*ZZ.PARAMETER_X)*1E-9 AS NUMERIC),2) TASK_COMPUTATIONAL_COMPLEXITY,
ZZ.VL_GRID_ROW_DIMENSION AS DAG_MAX_WIDTH,
5 AS DAG_MAX_HEIGHT,
ZZ.VL_DATASET_MEMORY_SIZE,
CASE
	WHEN ZZ.DS_DEVICE = 'CPU' THEN 1
	ELSE 0
END AS CPU,
CASE
	WHEN ZZ.DS_DEVICE = 'GPU' THEN 1
	ELSE 0
END AS GPU,
CASE
	WHEN ZZ.DS_STORAGE = 'GPFS' THEN 1
	ELSE 0
END AS SHARED_DISK,
CASE
	WHEN ZZ.DS_STORAGE = 'LOCAL_DISK' THEN 1
	ELSE 0
END AS LOCAL_DISK,
CASE
	WHEN ZZ.DS_SCHEDULER = 'es.bsc.compss.scheduler.orderstrict.fifo.FifoTS' THEN 1
	ELSE 0
END AS ORDER_STRICT_SCHEDULER,
CASE
	WHEN ZZ.DS_SCHEDULER = 'es.bsc.compss.scheduler.lookahead.successors.fifolocality.FifoLocalityTS' THEN 1
	ELSE 0
END AS DATA_LOCAL_SCHEDULER
FROM
(
	SELECT
	Y.VL_TOTAL_EXECUTION_TIME,
	Y.VL_INTER_TASK_EXECUTION_TIME,
	(Y.VL_INTER_TASK_EXECUTION_TIME - Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTER_TASK_OVERHEAD_TIME,
	Y.VL_INTER_TASK_EXECUTION_TIME - (Y.VL_INTER_TASK_EXECUTION_TIME - Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTER_TASK_EXECUTION_TIME_FREE_OVERHEAD,
	Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
	Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
	Y.VL_COMMUNICATION_TIME,
	Y.VL_ADDITIONAL_TIME,
	(Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC + Y.VL_COMMUNICATION_TIME) AS VL_INTRA_TASK_EXECUTION_TIME_FREE_ADDITIONAL,
	ROUND(((Y.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC)/(Y.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC-Y.VL_COMMUNICATION_TIME))::numeric,2) AS P_FRACTION,
	Y.ID_PARAMETER,
	Y.CD_PARAMETER,
	Y.CD_CONFIGURATION,
	Y.ID_ALGORITHM,
	Y.DS_ALGORITHM,
	Y.ID_FUNCTION,
	Y.DS_FUNCTION,
	Y.ID_DEVICE,
	Y.DS_DEVICE,
	Y.ID_DATASET,
	Y.ID_RESOURCE,
	Y.ID_PARAMETER_TYPE,
	Y.DS_PARAMETER_TYPE,
	Y.DS_PARAMETER_ATTRIBUTE,
	Y.PARAMETER_X,
	Y.DS_STORAGE,
	Y.DS_SCHEDULER,
	Y.NR_ITERATIONS,
	Y.VL_GRID_ROW_DIMENSION,
	Y.VL_GRID_COLUMN_DIMENSION,
	Y.VL_GRID_ROW_X_COLUMN_DIMENSION,
	Y.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
	Y.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
	Y.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
	Y.VL_BLOCK_ROW_DIMENSION,
	Y.VL_BLOCK_COLUMN_DIMENSION,
	Y.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
	Y.VL_BLOCK_MEMORY_SIZE,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
	Y.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
	Y.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
	Y.DS_RESOURCE,
	Y.NR_NODES,
	Y.NR_COMPUTING_UNITS_CPU,
	(Y.NR_NODES-1)*Y.NR_COMPUTING_UNITS_CPU AS NR_TOTAL_COMPUTING_UNITS_CPU,
	(Y.NR_NODES-1) || ' (' || (Y.NR_NODES-1)*Y.NR_COMPUTING_UNITS_CPU || ')' AS NR_CONCAT_NODES_TOTAL_COMPUTING_UNITS_CPU,
	Y.NR_COMPUTING_UNITS_GPU,
	Y.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
	Y.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
	Y.DS_DATASET,
	Y.VL_DATASET_MEMORY_SIZE,
	Y.DS_DATA_TYPE,
	Y.VL_DATA_TYPE_MEMORY_SIZE,
	Y.VL_DATASET_DIMENSION,
	Y.VL_DATASET_ROW_DIMENSION,
	Y.VL_DATASET_COLUMN_DIMENSION,
	Y.VL_DATASET_ROW_X_COLUMN_DIMENSION,
	Y.NR_RANDOM_STATE
	FROM
	(
		SELECT
		AVG(X.VL_TOTAL_EXECUTION_TIME) AS VL_TOTAL_EXECUTION_TIME,
		AVG(X.VL_INTER_TASK_EXECUTION_TIME) AS VL_INTER_TASK_EXECUTION_TIME,
		AVG(X.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC) AS VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
		AVG(X.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC) AS VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
		AVG(X.VL_COMMUNICATION_TIME_1) AS VL_COMMUNICATION_TIME_1,
		AVG(X.VL_COMMUNICATION_TIME_2) AS VL_COMMUNICATION_TIME_2,
		AVG(X.VL_COMMUNICATION_TIME) AS VL_COMMUNICATION_TIME,
		AVG(X.VL_ADDITIONAL_TIME_1) AS VL_ADDITIONAL_TIME_1,
		AVG(X.VL_ADDITIONAL_TIME_2) AS VL_ADDITIONAL_TIME_2,
		AVG(X.VL_ADDITIONAL_TIME) AS VL_ADDITIONAL_TIME,
		X.ID_PARAMETER,
		X.CD_PARAMETER,
		X.CD_CONFIGURATION,
		X.ID_ALGORITHM,
		X.DS_ALGORITHM,
		X.ID_FUNCTION,
		X.DS_FUNCTION,
		X.ID_DEVICE,
		X.DS_DEVICE,
		X.ID_DATASET,
		X.ID_RESOURCE,
		X.ID_PARAMETER_TYPE,
		X.DS_PARAMETER_TYPE,
		X.DS_PARAMETER_ATTRIBUTE,
		X.PARAMETER_X,
		X.DS_STORAGE,
		X.DS_SCHEDULER,
		X.NR_ITERATIONS,
		X.VL_GRID_ROW_DIMENSION,
		X.VL_GRID_COLUMN_DIMENSION,
		X.VL_GRID_ROW_X_COLUMN_DIMENSION,
		X.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
		X.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_BLOCK_ROW_DIMENSION,
		X.VL_BLOCK_COLUMN_DIMENSION,
		X.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
		X.VL_BLOCK_MEMORY_SIZE,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.DS_RESOURCE,
		X.NR_NODES,
		X.NR_COMPUTING_UNITS_CPU,
		X.NR_COMPUTING_UNITS_GPU,
		X.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
		X.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
		X.DS_DATASET,
		X.VL_DATASET_MEMORY_SIZE,
		X.DS_DATA_TYPE,
		X.VL_DATA_TYPE_MEMORY_SIZE,
		X.VL_DATASET_DIMENSION,
		X.VL_DATASET_ROW_DIMENSION,
		X.VL_DATASET_COLUMN_DIMENSION,
		X.VL_DATASET_ROW_X_COLUMN_DIMENSION,
		X.NR_RANDOM_STATE
		FROM
		(
			SELECT
				A.ID_EXPERIMENT,
				A.VL_TOTAL_EXECUTION_TIME,
				A.VL_INTER_TASK_EXECUTION_TIME,
				A.VL_INTRA_TASK_EXECUTION_TIME_FULL_FUNC,
				A.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC,
				A.VL_COMMUNICATION_TIME_1,
				A.VL_COMMUNICATION_TIME_2,
				A.VL_COMMUNICATION_TIME_1 + A.VL_COMMUNICATION_TIME_2 AS VL_COMMUNICATION_TIME,
				A.VL_ADDITIONAL_TIME_1,
				A.VL_ADDITIONAL_TIME_2,
				A.VL_ADDITIONAL_TIME_1 + A.VL_ADDITIONAL_TIME_2 AS VL_ADDITIONAL_TIME,
				(A.VL_INTRA_TASK_EXECUTION_TIME_DEVICE_FUNC + A.VL_ADDITIONAL_TIME_1 + A.VL_ADDITIONAL_TIME_2) AS VL_INTRA_TASK_EXECUTION_TIME_FREE_ADDITIONAL,
				A.DT_PROCESSING,
				B.ID_PARAMETER,
				B.CD_PARAMETER,
				B.CD_CONFIGURATION,
				B.ID_ALGORITHM,
				(SELECT DISTINCT X.DS_ALGORITHM FROM ALGORITHM X WHERE X.ID_ALGORITHM = B.ID_ALGORITHM) AS DS_ALGORITHM,
				B.ID_FUNCTION,
				(SELECT DISTINCT X.DS_FUNCTION FROM FUNCTION X WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS DS_FUNCTION,
				(SELECT DISTINCT Y.ID_DEVICE FROM FUNCTION X INNER JOIN DEVICE Y ON (X.ID_DEVICE = Y.ID_DEVICE) WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS ID_DEVICE,
				(SELECT DISTINCT Y.DS_DEVICE FROM FUNCTION X INNER JOIN DEVICE Y ON (X.ID_DEVICE = Y.ID_DEVICE) WHERE X.ID_FUNCTION = B.ID_FUNCTION) AS DS_DEVICE,
				B.ID_DATASET,
				B.ID_RESOURCE,
				B.ID_PARAMETER_TYPE,
				(SELECT X.DS_PARAMETER_TYPE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_PARAMETER_TYPE,
				(SELECT X.DS_PARAMETER_ATTRIBUTE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_PARAMETER_ATTRIBUTE,
				(SELECT X.NR_CLUSTER FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS PARAMETER_X,
				(SELECT X.DS_STORAGE FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_STORAGE,
				(SELECT X.DS_SCHDEULER FROM PARAMETER_TYPE X WHERE X.ID_PARAMETER_TYPE = B.ID_PARAMETER_TYPE) AS DS_SCHEDULER,
				B.NR_ITERATIONS,
				B.VL_GRID_ROW_DIMENSION,
				B.VL_GRID_COLUMN_DIMENSION,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION AS VL_GRID_ROW_X_COLUMN_DIMENSION,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION || '(' || ROUND(B.VL_BLOCK_MEMORY_SIZE*1e-6,2) || ')' AS VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
				ROUND((CAST(B.VL_GRID_COLUMN_DIMENSION AS NUMERIC)/CAST(D.VL_DATASET_COLUMN_DIMENSION AS NUMERIC))*100,2) AS VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
				B.VL_GRID_ROW_DIMENSION || ' x ' || B.VL_GRID_COLUMN_DIMENSION || ' (' || ROUND((CAST(B.VL_GRID_COLUMN_DIMENSION AS NUMERIC)/CAST(D.VL_DATASET_COLUMN_DIMENSION AS NUMERIC))*100,2) || '%)' AS VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
				B.VL_BLOCK_ROW_DIMENSION,
				B.VL_BLOCK_COLUMN_DIMENSION,
				B.VL_BLOCK_ROW_DIMENSION || ' x ' || B.VL_BLOCK_COLUMN_DIMENSION AS VL_BLOCK_ROW_X_COLUMN_DIMENSION,
				B.VL_BLOCK_MEMORY_SIZE,
				B.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
				B.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
				ROUND((CAST(B.VL_BLOCK_MEMORY_SIZE AS NUMERIC)/CAST(D.VL_DATASET_MEMORY_SIZE AS NUMERIC))*100,2) AS VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
				ROUND(B.VL_BLOCK_MEMORY_SIZE*1e-6,2) || ' (' || ROUND((CAST(B.VL_BLOCK_MEMORY_SIZE AS NUMERIC)/CAST(D.VL_DATASET_MEMORY_SIZE AS NUMERIC))*100,2) || '%)' AS VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
				C.DS_RESOURCE,
				C.NR_NODES,
				C.NR_COMPUTING_UNITS_CPU,
				C.NR_COMPUTING_UNITS_GPU,
				C.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
				C.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
				D.DS_DATASET,
				D.VL_DATASET_MEMORY_SIZE,
				D.DS_DATA_TYPE,
				D.VL_DATA_TYPE_MEMORY_SIZE,
				D.VL_DATASET_DIMENSION,
				D.VL_DATASET_ROW_DIMENSION,
				D.VL_DATASET_COLUMN_DIMENSION,
				D.VL_DATASET_ROW_DIMENSION || ' x ' || D.VL_DATASET_COLUMN_DIMENSION AS VL_DATASET_ROW_X_COLUMN_DIMENSION,
				D.NR_RANDOM_STATE
			FROM EXPERIMENT_RAW A
			INNER JOIN PARAMETER B ON (A.ID_PARAMETER = B.ID_PARAMETER)
			INNER JOIN RESOURCE C ON (B.ID_RESOURCE = C.ID_RESOURCE)
			INNER JOIN DATASET D ON (B.ID_DATASET = D.ID_DATASET)
			WHERE
			A.NR_ALGORITHM_ITERATION <> 0
		) X
		GROUP BY
		X.ID_PARAMETER,
		X.CD_PARAMETER,
		X.CD_CONFIGURATION,
		X.ID_ALGORITHM,
		X.DS_ALGORITHM,
		X.ID_FUNCTION,
		X.DS_FUNCTION,
		X.ID_DEVICE,
		X.DS_DEVICE,
		X.ID_DATASET,
		X.ID_RESOURCE,
		X.ID_PARAMETER_TYPE,
		X.DS_PARAMETER_TYPE,
		X.DS_PARAMETER_ATTRIBUTE,
		X.PARAMETER_X,
		X.DS_STORAGE,
		X.DS_SCHEDULER,
		X.NR_ITERATIONS,
		X.VL_GRID_ROW_DIMENSION,
		X.VL_GRID_COLUMN_DIMENSION,
		X.VL_GRID_ROW_X_COLUMN_DIMENSION,
		X.VL_CONCAT_GRID_ROW_X_COLUMN_DIMENSION_BLOCK_SIZE_MB,
		X.VL_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_CONCAT_GRID_COLUMN_DIMENSION_PERCENT_DATASET,
		X.VL_BLOCK_ROW_DIMENSION,
		X.VL_BLOCK_COLUMN_DIMENSION,
		X.VL_BLOCK_ROW_X_COLUMN_DIMENSION,
		X.VL_BLOCK_MEMORY_SIZE,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_CPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_GPU,
		X.VL_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.VL_CONCAT_BLOCK_MEMORY_SIZE_PERCENT_DATASET,
		X.DS_RESOURCE,
		X.NR_NODES,
		X.NR_COMPUTING_UNITS_CPU,
		X.NR_COMPUTING_UNITS_GPU,
		X.VL_MEMORY_SIZE_PER_CPU_COMPUTING_UNIT,
		X.VL_MEMORY_SIZE_PER_GPU_COMPUTING_UNIT,
		X.DS_DATASET,
		X.VL_DATASET_MEMORY_SIZE,
		X.DS_DATA_TYPE,
		X.VL_DATA_TYPE_MEMORY_SIZE,
		X.VL_DATASET_DIMENSION,
		X.VL_DATASET_ROW_DIMENSION,
		X.VL_DATASET_COLUMN_DIMENSION,
		X.VL_DATASET_ROW_X_COLUMN_DIMENSION,
		X.NR_RANDOM_STATE
	) Y
) ZZ
WHERE ZZ.ds_algorithm='KMEANS'
AND ZZ.nr_iterations = 5
AND ZZ.ds_dataset = 'S_10GB_1'
AND ZZ.id_resource = 18
AND ZZ.ID_PARAMETER_TYPE BETWEEN 17 AND 28
AND ZZ.VL_INTER_TASK_EXECUTION_TIME IS NOT NULL
) AS ZZZ
